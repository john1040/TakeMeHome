# Apple Sign In Setup Guide

This guide will help you generate the client secret required for Apple Sign In with Supabase.

## Prerequisites

1. ✅ Apple Developer account
2. ✅ `.p8` private key file from Apple Developer Portal
3. ✅ Services ID created in Apple Developer Portal
4. ✅ Node.js installed on your machine

## Step 1: Install Required Dependencies

```bash
npm install jsonwebtoken
```

## Step 2: Configure the Script

1. Open [`scripts/generate-apple-client-secret.js`](scripts/generate-apple-client-secret.js:1)
2. Update the `CONFIG` object with your Apple Developer details:

```javascript
const CONFIG = {
  teamId: 'ABC123DEFG',           // Your 10-character Team ID
  keyId: 'XXXXXXXXXX',           // Your 10-character Key ID from .p8 filename
  clientId: 'com.yourcompany.TakeMeHome.client', // Your Services ID
  privateKeyPath: './AuthKey_XXXXXXXXXX.p8',     // Path to your .p8 file
};
```

## Step 3: Find Your Apple Developer Information

### Team ID
1. Go to [Apple Developer Portal](https://developer.apple.com/account/)
2. Click **Membership** in the sidebar
3. Copy your **Team ID** (10-character string)

### Key ID
1. Look at your `.p8` filename: `AuthKey_XXXXXXXXXX.p8`
2. The `XXXXXXXXXX` part is your **Key ID**

### Services ID
1. Go to **Certificates, Identifiers & Profiles** → **Identifiers**
2. Select **Services IDs** from the dropdown
3. Find your Services ID (e.g., `com.yourcompany.TakeMeHome.client`)

## Step 4: Place Your .p8 File

1. Copy your `.p8` file to the project root directory
2. Update the `privateKeyPath` in the script to match your filename

## Step 5: Generate Client Secret

```bash
node scripts/generate-apple-client-secret.js
```

## Step 6: Configure Supabase

1. Go to [Supabase Dashboard](https://supabase.com/dashboard)
2. Navigate to **Authentication** → **Providers** → **Apple**
3. Enable Apple provider and configure:
   - **Client ID**: Your Services ID
   - **Client Secret**: The JWT token generated by the script
   - **Redirect URL**: `https://nkkaxelmylemiesxvmoz.supabase.co/auth/v1/callback`

## Step 7: Configure Apple Developer Portal

### Services ID Configuration
1. Go to **Certificates, Identifiers & Profiles** → **Identifiers**
2. Select your Services ID
3. Configure **Sign In with Apple**:
   - **Primary App ID**: Your main app ID
   - **Website URLs**:
     - **Domains**: `nkkaxelmylemiesxvmoz.supabase.co`
     - **Return URLs**: `https://nkkaxelmylemiesxvmoz.supabase.co/auth/v1/callback`

## Troubleshooting

### "jsonwebtoken package not found"
```bash
npm install jsonwebtoken
```

### "Private key file not found"
- Ensure your `.p8` file is in the correct location
- Check the `privateKeyPath` in the CONFIG object
- Verify file permissions

### "Invalid key" error
- Verify your Key ID matches the `.p8` filename
- Ensure the `.p8` file isn't corrupted
- Check that you're using the correct Team ID

### Supabase connection issues
- Verify the Services ID is correctly configured in Apple Developer Portal
- Check that the redirect URL matches exactly
- Ensure the client secret hasn't expired (6 months max)

## Security Notes

⚠️ **Important**: 
- Never commit your `.p8` file to version control
- Add `*.p8` to your `.gitignore` file
- The generated client secret expires in 6 months
- Keep your Team ID, Key ID, and private key secure

## Client Secret Expiration

Apple client secrets expire after 6 months maximum. You'll need to:
1. Run the script again to generate a new token
2. Update the client secret in Supabase
3. The old token will stop working after expiration